<project name="BOS-installer" default="generate.installer.all">
	
	<property file="build.properties"/>
	<property name="updated.project.file" location="${basedir}/updated-project-file.xml"/>
	
	<condition property="bitrock.builder" value="${bitrock.install}/bin/Builder.app/Contents/MacOS/installbuilder.sh">
	  <os family="mac"/>
	</condition>
	<condition property="bitrock.builder" value="${bitrock.install}/bin/builder">
    <os family="unix" />
	</condition>
	<condition property="bitrock.builder" value="${bitrock.install}/bin/builder.bat">
	  <os family="windows" />
	</condition>
	
	<target name="check">
		<fail message="Bitrock builder [${bitrock.builder}] not found">
			<condition>
				<not>
					<available file="${bitrock.builder}"/>
				</not>
			</condition>
		</fail>
	</target>
	
	<target name="generate.installer.all" depends="check, generate.installer.mac, generate.installer.linux, generate.installer.windows"
		if="bitrock.builder" />
		
	<target name="generate.installer.linux">
	  <antcall target="generate.installer">
	    <param name="target.platform" value="linux" />
	  </antcall>
	</target>
	
	<target name="generate.installer.windows">
   <antcall target="generate.installer">
	    <param name="target.platform" value="windows" />
	  </antcall>
	</target>
	
	<target name="generate.installer.mac">
		<antcall target="generate.installer">
      <param name="target.platform" value="osx" />
		</antcall>
	</target>
	
	<target name="generate.bitrock.project.file">
		<copy file="${project.file}" tofile="${updated.project.file}" overwrite="true"/>
				<!-- PRODUCT -->
				<replace file="${updated.project.file}" token="@vendor@" value="${vendor}"/>
				<replace file="${updated.project.file}" token="@product.short.name@" value="${product.short.name}"/>
				<replace file="${updated.project.file}" token="@product.full.name@" value="${product.full.name}"/>
				<replace file="${updated.project.file}" token="@product.version@" value="${product.version}"/>
				<replace file="${updated.project.file}" token="@file.shortname@" value="${file.shortname}"/>
				
				<!-- RESOURCES -->
				<replace file="${updated.project.file}" token="@license@" value="${license}"/>
				<replace file="${updated.project.file}" token="@wizard.image@" value="${wizard.image}"/>
				<replace file="${updated.project.file}" token="@titlebar.image@" value="${titlebar.image}"/>
				<replace file="${updated.project.file}" token="@mac.icns@" value="${mac.icns}"/>
				<replace file="${updated.project.file}" token="@mac.installer.icns@" value="${mac.installer.icns}"/>
				<replace file="${updated.project.file}" token="@windows.ico@" value="${windows.ico}"/>
				<replace file="${updated.project.file}" token="@linux.icon@" value="${linux.icon}"/>
				<replace file="${updated.project.file}" token="@installer.name@" value="${installer.name}"/>
				<replace file="${updated.project.file}" token="@logo@" value="${logo}"/>
				<replace file="${updated.project.file}" token="@leftImage@" value="${leftImage}"/>
				<replace file="${updated.project.file}" token="@splash@" value="${splash}"/>
				
				<replace file="${updated.project.file}" token="@studio.dir@" value="${studio.dir}"/>
				<replace file="${updated.project.file}" token="@bitrock.output@" value="${bitrock.output}"/>
				
				<replace file="${updated.project.file}" token="@linux.shortcut@" value="${linux.shortcut}"/>
				<replace file="${updated.project.file}" token="@windows.shortcut@" value="${windows.shortcut}"/>
				<replace file="${updated.project.file}" token="@windows64.shortcut@" value="${windows64.shortcut}"/>
				
				<replace file="${updated.project.file}" token="@mac.shortcut@" value="${mac.shortcut}"/>
				<replace file="${updated.project.file}" token="@shortcut.comment@" value="${shortcut.comment}"/>
				<replace file="${updated.project.file}" token="@shortcut.name@" value="${shortcut.name}"/>
				<replace file="${updated.project.file}" token="@mac.shortcut.name@" value="${mac.shortcut.name}"/>
				<replace file="${updated.project.file}" token="@windows.shortcut.name@" value="${windows.shortcut.name}"/>
		    	<replace file="${updated.project.file}" token="@linux.shortcut.name@" value="${linux.shortcut.name}"/>
				
				<replace file="${updated.project.file}" token="@slide1@" value="${slide1}"/>
				<replace file="${updated.project.file}" token="@slide2@" value="${slide2}"/>
				<replace file="${updated.project.file}" token="@slide3@" value="${slide3}"/>
			    <replace file="${updated.project.file}" token="@slide4@" value="${slide4}"/>
	</target>
	
	<target name="generate.installer">
		<copy file="${project.file}" tofile="${updated.project.file}" overwrite="true"/>
		
		<!-- PRODUCT -->
		<replace file="${updated.project.file}" token="@vendor@" value="${vendor}"/>
		<replace file="${updated.project.file}" token="@product.short.name@" value="${product.short.name}"/>
		<replace file="${updated.project.file}" token="@product.full.name@" value="${product.full.name}"/>
		<replace file="${updated.project.file}" token="@product.version@" value="${product.version}"/>
		<replace file="${updated.project.file}" token="@file.shortname@" value="${file.shortname}"/>
		
		<!-- RESOURCES -->
		<replace file="${updated.project.file}" token="@license@" value="${license}"/>
		<replace file="${updated.project.file}" token="@wizard.image@" value="${wizard.image}"/>
		<replace file="${updated.project.file}" token="@titlebar.image@" value="${titlebar.image}"/>
		<replace file="${updated.project.file}" token="@mac.icns@" value="${mac.icns}"/>
		<replace file="${updated.project.file}" token="@mac.installer.icns@" value="${mac.installer.icns}"/>
		<replace file="${updated.project.file}" token="@windows.ico@" value="${windows.ico}"/>
		<replace file="${updated.project.file}" token="@linux.icon@" value="${linux.icon}"/>
		<replace file="${updated.project.file}" token="@installer.name@" value="${installer.name}"/>
		<replace file="${updated.project.file}" token="@logo@" value="${logo}"/>
		<replace file="${updated.project.file}" token="@leftImage@" value="${leftImage}"/>
		<replace file="${updated.project.file}" token="@splash@" value="${splash}"/>
		
		<replace file="${updated.project.file}" token="@studio.dir@" value="${studio.dir}"/>
		<replace file="${updated.project.file}" token="@bitrock.output@" value="${bitrock.output}"/>
		
		<replace file="${updated.project.file}" token="@linux.shortcut@" value="${linux.shortcut}"/>
		<replace file="${updated.project.file}" token="@windows.shortcut@" value="${windows.shortcut}"/>
		<replace file="${updated.project.file}" token="@windows64.shortcut@" value="${windows64.shortcut}"/>
		
		<replace file="${updated.project.file}" token="@mac.shortcut@" value="${mac.shortcut}"/>
		<replace file="${updated.project.file}" token="@shortcut.comment@" value="${shortcut.comment}"/>
		<replace file="${updated.project.file}" token="@shortcut.name@" value="${shortcut.name}"/>
		<replace file="${updated.project.file}" token="@mac.shortcut.name@" value="${mac.shortcut.name}"/>
		<replace file="${updated.project.file}" token="@windows.shortcut.name@" value="${windows.shortcut.name}"/>
    	<replace file="${updated.project.file}" token="@linux.shortcut.name@" value="${linux.shortcut.name}"/>
		
		<replace file="${updated.project.file}" token="@slide1@" value="${slide1}"/>
		<replace file="${updated.project.file}" token="@slide2@" value="${slide2}"/>
		<replace file="${updated.project.file}" token="@slide3@" value="${slide3}"/>
	    <replace file="${updated.project.file}" token="@slide4@" value="${slide4}"/>
    	
		<exec executable="${bitrock.builder}">
     		<arg line="build ${updated.project.file} ${target.platform}"/>
		</exec>
		<delete file="${updated.project.file}"/>
	</target>
		
</project> 
